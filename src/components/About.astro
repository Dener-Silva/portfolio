---
import AboutCard from "./AboutCard.astro";
import "../styles/about.css";
---

<script>
    const cards: NodeListOf<HTMLElement> =
        document.querySelectorAll(".about-card");
    const resetButton: HTMLButtonElement | null =
        document.querySelector(".reset-button");
    if (!resetButton) {
        throw new Error("Reset button not found");
    }

    // Hack for Firefox because it persists the button state across
    // page loads
    resetButton.disabled = true;

    // It's humanly impossible to reach the highest zIndex value,
    // so we just increment it to make sure the active card is on top
    let zIndex = 0;
    for (const card of cards) {
        card.onclick = () => {
            zIndex++;
            card.style.zIndex = zIndex.toString();
        };
        const x: HTMLElement | null = card.querySelector(".x");
        if (x) {
            x.onclick = () => {
                card.style.animation = "fade-out 500ms forwards";
            };
        }
        card.addEventListener("animationend", (e) => {
            if (e.animationName === "fade-out") {
                card.style.display = "none";
                resetButton.disabled = false;
            }
        });
    }

    resetButton.onclick = () => {
        for (const card of cards) {
            if (card.style.display === "none") {
                card.style.display = "flex";
                card.style.animation = "fade-in 500ms forwards";
            }
            card.style.removeProperty("z-index");
        }
        zIndex = 0;
        resetButton.disabled = true;
    };
</script>
<div class="about">
    <AboutCard
        title="Database"
        src={`${import.meta.env.BASE_URL}database.svg`}
        position={[80, 20]}
    >
        a
    </AboutCard>
    <AboutCard
        title="Frontend"
        src={`${import.meta.env.BASE_URL}client.svg`}
        position={[-20, 120]}
    >
        a
    </AboutCard>
    <AboutCard
        title="Backend"
        src={`${import.meta.env.BASE_URL}server.svg`}
        position={[30, 70]}
    >
        a
    </AboutCard>
</div>
<button class="reset-button" disabled>Reset</button>
